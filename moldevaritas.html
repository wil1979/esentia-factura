<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Molde Caja - Promocionales Esentia</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: #f7f7f7;
    }

    h1, #opciones {
      background: #fff;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    label {
      margin-right: 1rem;
      display: inline-block;
    }

    .molde {
      width: 19cm;
      height: 28.5cm;
      position: relative;
      border: 1px dashed #aaa;
      background-color: #fff;
      background-size: cover;
      background-image: url('../etiqueta/molde_varitas.png');
      background-position: center;
      margin: 2rem auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .cara {
      position: absolute;
      width: 4cm;
      height: 28.5cm;
      top: 0;
      border: 1px solid transparent;
      box-sizing: border-box;
      padding: 14.5rem 1rem;
    }

    .cara:hover {
      border: 1px solid rgba(0, 100, 255, 0.5);
    }

    .cara.frente { left: 20%; background-color: rgba(246, 248, 250, 0.1); }
    .cara.lateral-izq { left: 40%; background-color: rgba(249, 250, 250, 0.1); }
    .cara.dorso { left: 60%; background-color: rgba(253, 253, 252, 0.1); }
    .cara.lateral-der { left: 80%; background-color: rgba(241, 239, 241, 0.1); }

    .solapa {
      position: absolute;
      width: 2.3cm;
      height: 28.5cm;
      top: 0;
      background-color: rgba(228, 227, 227, 0.2);
      border: 1px solid #ddd;
    }

    .solapa.izquierda { left: 0; }
    .solapa.derecha { right: 0; }

    .molde img.producto {
      position: absolute;
      width: 70%;
      top: 55%;
      left: 255%;
      transform: translate(-50%, -50%);
      z-index: 2;
    }

    .molde img.logo {
      position: absolute;
      width: 105%;
      top: 19%;
      left: 122%;
      transform: translateX(-50%);
      z-index: 2;
    }

    .molde .nombre {
      position: absolute;
      bottom: 190%;
      width: 35%;
      left: 255%;
      text-align: center;
      font-size: 2.5rem;
      font-weight: bold;
      color: #b3acbe;
      z-index: 2;
    }

    .molde .descripcion {
      position: relative;
      top: 120%;
      width: 120%;
      left: -210%;
      text-align: center;
      font-size: 0.8rem;
      color: #0f0f0f;
      z-index: 2;
    }

    .molde .ingredientes {
      position: absolute;
      bottom: 45%;
      width: 90%;
      left: 82%;
      text-align: center;
      font-size: 0.8rem;
      color: #690a0a;
      z-index: 2;
    }

    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: #5a0bab;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    button:hover {
      background: #3f0889;
    }

    .error {
      color: red;
      font-weight: bold;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 600px;
    }

    .close {
      float: right;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
    }

    .close:hover,
    .close:focus {
      color: black;
      cursor: pointer;
    }

    /* Impresi√≥n */
    @media print {
      body {
        background: white;
      }

      h1, #opciones, .modal, button, .error {
        display: none !important;
      }

      .molde {
        box-shadow: none !important;
        margin: 0 auto !important;
        border: none;
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>

<h1>Generador de Moldes para Caja - Promocionales Esentia</h1>

<div id="opciones">
  <label for="producto"><strong>Selecciona producto:</strong></label>
  <select id="producto"></select>
  <br><br>
  <label><input type="checkbox" id="mostrarLogo" checked> Mostrar logo</label>
  <label><input type="checkbox" id="mostrarImagen" checked> Mostrar imagen del producto</label>
  <label><input type="checkbox" id="mostrarNombre" checked> Mostrar nombre</label>
  <label><input type="checkbox" id="mostrarSolapas" checked> Mostrar solapas</label>
  <br><br>
  <button id="generarTodos">Generar todos los moldes</button>
  <button id="abrirModal">Ajustar posiciones</button>
  <button onclick="window.print()">üñ®Ô∏è Imprimir molde</button>
</div>

<div id="contenedorMoldes"></div>
<div id="mensajeError" class="error"></div>

<!-- Modal -->
<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Ajustar Posiciones</h2>
    <form id="posicionForm">
      <label for="generalWidth">Ancho total del molde (cm):</label>
      <input type="number" id="generalWidth" step="0.1"><br>
      <label for="generalHeight">Altura total del molde (cm):</label>
      <input type="number" id="generalHeight" step="0.1"><br>
      <h3>Cara Frontal</h3>
      <label for="frenteLeft">Posici√≥n izquierda (%):</label>
      <input type="number" id="frenteLeft" step="1"><br>
      <h3>Cara Lateral Izquierda</h3>
      <label for="lateralIzqLeft">Posici√≥n izquierda (%):</label>
      <input type="number" id="lateralIzqLeft" step="1"><br>
      <h3>Cara Dorso</h3>
      <label for="dorsoLeft">Posici√≥n izquierda (%):</label>
      <input type="number" id="dorsoLeft" step="1"><br>
      <h3>Cara Lateral Derecha</h3>
      <label for="lateralDerLeft">Posici√≥n izquierda (%):</label>
      <input type="number" id="lateralDerLeft" step="1"><br>
      <button type="button" id="guardarPosiciones">Guardar</button>
    </form>
  </div>
</div>

<script>
  const selectProducto = document.getElementById('producto');
  const contenedor = document.getElementById('contenedorMoldes');
  const mensajeError = document.getElementById('mensajeError');

  const productosPrueba = [
    {
      nombre: "Varita Energ√©tica Azul",
      imagen: "https://placehold.co/200x300/0055ff/ffffff?text=Producto",
      descripcion: "Varita energ√©tica de alta frecuencia para bienestar emocional.",
      ingredientes: ["Cristal de cuarzo", "Aceite esencial de lavanda", "Energ√≠a reiki"]
    },
    {
      nombre: "Varita de Luna",
      imagen: "https://placehold.co/200x300/ffcc00/000000?text=Luna",
      descripcion: "Ideal para meditaci√≥n nocturna y conexi√≥n espiritual.",
      ingredientes: ["Piedra de luna", "Plata", "Aceite de s√°ndalo"]
    }
  ];

  let productos = [];
  let productoActual = 0;
  let configuracion = {
    generalWidth: 22.8,
    generalHeight: 28.5,
    frenteLeft: 20,
    lateralIzqLeft: 40,
    dorsoLeft: 60,
    lateralDerLeft: 80
  };

  fetch('productos_esentia.json')
    .then(res => res.ok ? res.json() : Promise.reject(res))
    .then(data => { productos = data; inicializarProductos(); })
    .catch(() => {
      mensajeError.textContent = '‚ö†Ô∏è No se encontr√≥ productos_esentia.json. Usando datos de prueba.';
      productos = productosPrueba;
      inicializarProductos();
    });

  function inicializarProductos() {
    selectProducto.innerHTML = '';
    productos.forEach((prod, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = prod.nombre;
      selectProducto.appendChild(opt);
    });
    mostrarProducto(0);
  }

  selectProducto.addEventListener('change', () => {
    const nuevo = parseInt(selectProducto.value);
    if (nuevo !== productoActual) {
      productoActual = nuevo;
      mostrarProducto(nuevo);
    }
  });

  document.querySelectorAll('#opciones input[type=checkbox]').forEach(cb => {
    cb.addEventListener('change', () => mostrarProducto(productoActual));
  });

  document.getElementById('generarTodos').addEventListener('click', () => {
    contenedor.innerHTML = '';
    productos.forEach(p => contenedor.appendChild(crearMolde(p)));
  });

  function mostrarProducto(i) {
    contenedor.innerHTML = '';
    contenedor.appendChild(crearMolde(productos[i]));
  }

  function crearMolde(prod) {
    const molde = document.createElement('div');
    molde.className = 'molde';

    const partes = ['frente', 'lateral-izq', 'dorso', 'lateral-der'];
    partes.forEach(cara => {
      const div = document.createElement('div');
      div.className = `cara ${cara}`;

      if (cara === 'frente') {
        if (document.getElementById('mostrarImagen').checked) {
          const img = new Image();
          img.src = prod.imagen;
          img.className = 'producto';
          div.appendChild(img);
        }
        if (document.getElementById('mostrarLogo').checked) {
          const logo = new Image();
          logo.src = 'images/logo.png';
          logo.className = 'logo';
          div.appendChild(logo);
        }
        if (document.getElementById('mostrarNombre').checked) {
          const nombre = document.createElement('div');
          nombre.className = 'nombre';
          nombre.textContent = prod.nombre;
          div.appendChild(nombre);
        }
      } else if (cara === 'lateral-izq') {
        if (prod.imagen) {
          const img = new Image();
          img.src = prod.imagen;
          img.style.width = '100%';
          img.style.top = '-180%';
          img.style.left = '50%';
          img.style.transform = 'translate(-60%, 140%)';
          div.appendChild(img);
        }
      } else if (cara === 'dorso') {
        const desc = document.createElement('div');
        desc.className = 'descripcion';
        desc.textContent = prod.descripcion || '30ml.';
        div.appendChild(desc);

        const ing = document.createElement('div');
        ing.className = 'ingredientes';
        ing.textContent = `Indicaciones: ${Array.isArray(prod.ingredientes) ? prod.ingredientes.join(', ') : 'Ambientador de Varitas para uso en oficinas u Hogar, producto no consumible, evitar el contacto con la piel y los ojos'}`;
        div.appendChild(ing);
      } else if (cara === 'lateral-der') {
        const qr = new Image();
        qr.src = "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://wil1979.github.io/esentia-factura/catalogo.html";
        qr.style.width = '50%';
        qr.style.top = '50%';
        qr.style.left = '50%';
        qr.style.transform = 'translate(-20%, 799%)';
        div.appendChild(qr);
      }

      molde.appendChild(div);
    });

    molde.querySelector('.cara.frente').style.left = `${configuracion.frenteLeft}%`;
    molde.querySelector('.cara.lateral-izq').style.left = `${configuracion.lateralIzqLeft}%`;
    molde.querySelector('.cara.dorso').style.left = `${configuracion.dorsoLeft}%`;
    molde.querySelector('.cara.lateral-der').style.left = `${configuracion.lateralDerLeft}%`;
    molde.style.width = `${configuracion.generalWidth}cm`;
    molde.style.height = `${configuracion.generalHeight}cm`;

    if (document.getElementById('mostrarSolapas').checked) {
      molde.appendChild(Object.assign(document.createElement('div'), { className: 'solapa izquierda' }));
      molde.appendChild(Object.assign(document.createElement('div'), { className: 'solapa derecha' }));
    }

    return molde;
  }

  // Modal l√≥gica
  const modal = document.getElementById('myModal');
  document.getElementById('abrirModal').onclick = () => {
    modal.style.display = "block";
    document.getElementById('generalWidth').value = configuracion.generalWidth;
    document.getElementById('generalHeight').value = configuracion.generalHeight;
    document.getElementById('frenteLeft').value = configuracion.frenteLeft;
    document.getElementById('lateralIzqLeft').value = configuracion.lateralIzqLeft;
    document.getElementById('dorsoLeft').value = configuracion.dorsoLeft;
    document.getElementById('lateralDerLeft').value = configuracion.lateralDerLeft;
  };
  document.querySelector('.close').onclick = () => modal.style.display = "none";
  window.onclick = e => { if (e.target === modal) modal.style.display = "none"; };

  document.getElementById('guardarPosiciones').onclick = () => {
    configuracion.generalWidth = parseFloat(document.getElementById('generalWidth').value);
    configuracion.generalHeight = parseFloat(document.getElementById('generalHeight').value);
    configuracion.frenteLeft = parseFloat(document.getElementById('frenteLeft').value);
    configuracion.lateralIzqLeft = parseFloat(document.getElementById('lateralIzqLeft').value);
    configuracion.dorsoLeft = parseFloat(document.getElementById('dorsoLeft').value);
    configuracion.lateralDerLeft = parseFloat(document.getElementById('lateralDerLeft').value);
    modal.style.display = "none";
    mostrarProducto(productoActual);
  };
</script>

</body>
</html>
