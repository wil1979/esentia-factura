<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ðŸ‘¥ Clientes - Esentia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f5f7fa;
  padding: 16px;
}
h2 {
  text-align:center;
  color:#6c4ba3;
  margin-bottom:10px;
}
input {
  width:100%;
  max-width:400px;
  padding:10px;
  margin:0 auto 16px;
  display:block;
  border-radius:8px;
  border:1px solid #ccc;
}
table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th, td {
  padding:10px;
  border-bottom:1px solid #eee;
  font-size:0.9rem;
}
th {
  background:#6c4ba3;
  color:#fff;
}
tr:nth-child(even){
  background:#faf7ff;
}
</style>
</head>

<body>

<h2>ðŸ‘¥ Clientes</h2>

<input id="buscador" placeholder="Buscar por nombre o cÃ©dulaâ€¦">

<table>
<thead>
<tr>
  <th>Nombre</th>
  <th>CÃ©dula</th>
  <th>TelÃ©fono</th>
  <th>Compras</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDuMNZrLgxBs6CbuPp8j0iyynejt6WCpnQ",
  authDomain: "esentiacreditos-8345f.firebaseapp.com",
  projectId: "esentiacreditos-8345f",
  storageBucket: "esentiacreditos-8345f.firebasestorage.app",
  messagingSenderId: "888658236080",
  appId: "1:888658236080:web:506e5e2085b5a452dba175"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const tbody = document.getElementById("tabla");
const buscador = document.getElementById("buscador");

let clientes = [];

/* ðŸ”¹ PINTAR TABLA */
function render(lista) {
  tbody.innerHTML = "";

  if (!lista.length) {
    tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Sin resultados</td></tr>`;
    return;
  }

  lista.forEach(c => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.nombre || 'â€”'}</td>
      <td>${c.cedula || 'â€”'}</td>
      <td>${c.telefono || 'â€”'}</td>
      <td>${(c.compras || []).length}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* ðŸ”¹ CARGA INICIAL */
async function cargar() {
  const snap = await getDocs(collection(db, "clientes"));
  clientes = [];

  snap.forEach(d => {
    const data = d.data();
    clientes.push({
      nombre: data.nombre || "",
      cedula: (data.cedula || "").toString(),
      telefono: data.telefono || "",
      compras: data.compras || []
    });
  });

  render(clientes);
}

/* ðŸ”¹ BUSCADOR */
buscador.addEventListener("input", () => {
  const f = buscador.value.toLowerCase();
  const filtrados = clientes.filter(c =>
    c.nombre.toLowerCase().includes(f) ||
    c.cedula.includes(f)
  );
  render(filtrados);
});

cargar();
</script>

</body>
</html>