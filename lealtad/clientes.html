<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Esentia â€” Clientes</title>
  <link rel="icon" href="images/logo.png" sizes="192x192" />

  <link rel="stylesheet" href="clientes.css" />

  
</head>
<body>
  <div class="logo-container">
    <img src="https://wil1979.github.io/esentia-factura/images/logo.png" alt="Esentia Logo" class="logo">
  </div>

<div class="layout">

  <!-- ================= SIDEBAR CLIENTES ================= -->
  <div id="app">
  <aside id="panel-clientes">
  <h2>ğŸ‘¥ Clientes</h2>
  <input id="buscador-clientes" type="text" placeholder="Buscar cliente..." />
  <button id="btn-nuevo-cliente">â• </button>
  <button id="btn-refrescar-clientes">ğŸ”„</button>
  <button id="btn-toggle-deudores">ğŸ’°</button> <!-- ğŸ”¹ NUEVO -->
  <div id="lista-clientes" style="margin-top:12px;">

    <div id="skeleton-clientes" class="skeleton-list">
     <div class="skeleton-item"></div>
     <div class="skeleton-item"></div>
     <div class="skeleton-item"></div>
     <div class="skeleton-item"></div>
    </div>

  </div>

  </aside>

  <!-- ================= CONTENIDO PRINCIPAL ================= -->
  <main id="panel-detalle">

    <!-- INFO CLIENTE -->
    <div id="info-cliente" class="card vacio">
      <div id="info-basica"></div>

      

    </div>

    <!-- HISTORIAL DE COMPRAS -->
    <div id="panel-historial" class="card hidden">
      <h3>ğŸ§¾ Historial de compras</h3>
      <div id="historial-compras"></div>
    </div>
    
    <div id="resumen-general" style="
  background:#fff;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
  border:1px solid #ddd;
">

</div>

  </main>

</div>

<!-- ================= MODAL NUEVO CLIENTE ================= -->
<div id="modal-nuevo-cliente" class="modal hidden"
  style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center;">

  <div style="background:white; padding:25px; border-radius:12px; width:90%; max-width:500px;">
    <h2>ğŸ‘¤ Registrar Nuevo Cliente</h2>

    <!-- ğŸ” Buscador desde personal.json -->
    <div style="margin-bottom:15px;">
      <label>Buscar Persona (CÃ©dula o Nombre):</label>
      <input type="text" id="buscador-personal" placeholder="Buscar en personal.json" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
      <div id="resultados-personal" 
        style="max-height:150px; overflow-y:auto; border:1px solid #eee; margin-top:5px; border-radius:6px; display:none;">
        <!-- AquÃ­ aparecen los resultados -->
      </div>
    </div>

    <!-- ğŸ†” CÃ©dula + API Hacienda -->
    <div style="margin-bottom:15px;">
      <label>CÃ©dula:</label>
      <input type="text" id="modal-cedula" placeholder="Ej: 112230405" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;" maxlength="12">
      <small id="nombre-desde-api" style="color:#4CAF50; display:block; margin-top:5px; font-weight:bold;"></small>
    </div>

    <!-- ğŸ‘¤ Nombre editable -->
    <div style="margin-bottom:15px;">
      <label>Nombre (editable):</label>
      <input type="text" id="modal-nombre" placeholder="Nombre del cliente" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
    </div>

    <!-- ğŸ“ TelÃ©fono -->
    <div style="margin-bottom:20px;">
      <label>TelÃ©fono (8 dÃ­gitos):</label>
      <input type="text" id="modal-telefono" placeholder="Ej: 88889999" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;" maxlength="8">
    </div>

    <!-- âœ… Botones -->
    <div style="display:flex; gap:10px; justify-content:flex-end;">
      <button class="boton-accion" style="background:#666; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer;"
        onclick="cerrarModalNuevoCliente()">âŒ Cancelar</button>
      <button class="boton-accion" style="background:#4CAF50; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer;"
        onclick="guardarNuevoCliente()">âœ… Guardar y Agregar Productos</button>
    </div>
  </div>
</div>

<!-- =============================== -->
<!-- ğŸ›’ MODAL PRODUCTOS / NUEVA VENTA -->
<!-- =============================== -->
<div id="modal-productos" class="modal hidden">
  <div class="modal-contenido">

    <h2>ğŸ›’ Nueva Venta</h2>

    <!-- PRODUCTO -->
    <label>Producto</label>
    <select id="select-producto"></select>

    <label>PresentaciÃ³n</label>
    <select id="select-variante"></select>

    <button type="button" onclick="agregarAlCarritoModal()">â• Agregar</button>

    <hr>

    <!-- CARRITO -->
    <div id="carrito-modal"></div>

    <hr>

    <!-- DESCUENTO -->
    <label>Descuento â‚¡</label>
    <input type="number" id="descuento" value="0" min="0">

    <!-- TIPO DE PAGO -->
    <label>Tipo de pago</label>
    <select id="tipo-pago">
      <option value="contado">Contado</option>
      <option value="credito">CrÃ©dito</option>
    </select>

    <!-- MÃ‰TODO DE PAGO -->
    <label>MÃ©todo de pago</label>
<select id="metodo-pago">
  <option value="Efectivo">Efectivo</option>
  <option value="SINPE">SINPE</option>
  <option value="Transferencia">Transferencia</option>
  <option value="Tarjeta">Tarjeta</option>
  <option value="Pendiente">Pendiente</option>
</select>

    <!-- ğŸ§¾ RESUMEN DE VENTA (ğŸ”¥ ESTE ERA EL FALTANTE ğŸ”¥) -->
    <div id="resumen-venta" style="
      margin-top: 15px;
      padding: 12px;
      border-radius: 10px;
      background: #608bb6;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    ">
      <!-- Se llena por JS -->
    </div>

    <div id="resumen-pagos"
         style="margin-top: 16px;padding: 14px;border-radius: 12px;
                background: #f8f9fa;border: 1px solid #ddd;font-size: 0.95rem;">  
      <!-- Se llena desde JS -->
    </div>

    <!-- ACCIONES -->
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:15px">
      <button type="button" onclick="cerrarModalProductos()">Cancelar</button>
      <button type="button" onclick="facturarVenta()" style="background:green;color:white">
        ğŸ’¾ Facturar
      </button>
    </div>

  </div>
</div>

<!-- =============================== -->
<!-- âœï¸ MODAL EDITAR COMPRA -->
<!-- =============================== -->
<div id="modal-editar-compra" class="modal hidden">
  <div class="modal-contenido" style="max-width:600px">

    <h2>âœï¸ Editar Compra</h2>

    <div id="edit-productos"></div>

    <label>Descuento â‚¡</label>
    <input type="number" id="edit-descuento" value="0" min="0">

    <!-- RESUMEN EDICIÃ“N -->
    <div id="edit-resumen-venta"
         style="margin-top:15px;padding:12px;border-radius:10px;
                background:#f1f1f1;border:1px solid #ccc;font-size:.9rem">
    </div>
    <div id="resumen-pagos"
         style="margin-top: 16px;padding: 14px;border-radius: 12px;
                background: #f8f9fa;border: 1px solid #ddd;font-size: 0.95rem;">  
      <!-- Se llena desde JS -->
    </div>



    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:15px">
      <button type="button" onclick="cerrarModalEditarCompra()">Cancelar</button>
      <button type="button" onclick="guardarEdicionCompra()"
              style="background:#1976d2;color:white">
        ğŸ’¾ Guardar
      </button>
    </div>

  </div>
</div>

<!-- ================= MODAL PAGAR FACTURA ================= -->
<div id="modal-pagar-factura" class="modal hidden">
  <div class="modal-contenido" style="max-width:420px;">
    <h2>ğŸ’³ Pagar factura</h2>

    <div id="info-factura-pago" style="margin-bottom:10px;"></div>

    <label>Monto a abonar â‚¡</label>
    <input type="number" id="abono-monto" min="1" />

    <label>MÃ©todo de pago</label>
    <select id="abono-metodo">
      <option value="Efectivo">Efectivo</option>
      <option value="SINPE">SINPE</option>
      <option value="Transferencia">Transferencia</option>
      <option value="Tarjeta">Tarjeta</option>
      <option value="Pendiente">Pendiente</option>
    </select>

    <label>Nota (opcional)</label>
    <input type="text" id="abono-nota" placeholder="Ej: SINPE 8844-XXXX" />

    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px">
      <button onclick="cerrarModalPagoFactura()">Cancelar</button>
      <button onclick="guardarPagoFactura()" style="background:green;color:white">
        ğŸ’¾ Registrar pago
      </button>
    </div>
  </div>
</div>

<div id="modal-metodo-pago" class="modal hidden">
  <div class="modal-contenido" style="max-width:320px">
    <h3>ğŸ’³ Cambiar mÃ©todo</h3>

    <select id="select-metodo-pago">
      <option value="Efectivo">Efectivo</option>
      <option value="SINPE">SINPE</option>
      <option value="Transferencia">Transferencia</option>
      <option value="Tarjeta">Tarjeta</option>
    </select>

    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px">
      <button onclick="cerrarModalMetodoPago()">Cancelar</button>
      <button onclick="guardarMetodoPago()" style="background:green;color:white">
        ğŸ’¾ Guardar
      </button>
    </div>
  </div>
</div>


<div id="modal-abonos" class="modal hidden">
  <div class="modal-contenido" style="max-width:420px;">
    <h3>ğŸ’³ Pagos realizados</h3>

    <div id="lista-abonos"></div>

    <div style="display:flex;justify-content:flex-end;margin-top:12px">
      <button onclick="cerrarModalAbonos()">Cerrar</button>
    </div>
  </div>
</div>

<div id="modal-historial-periodo" class="modal hidden">
  <div class="modal-contenido" style="max-width:480px;">
    <h3>ğŸ§¾ Historial de pagos</h3>

    <label>Desde</label>
    <input type="date" id="filtro-desde">

    <label>Hasta</label>
    <input type="date" id="filtro-hasta">

    <button onclick="filtrarHistorialPeriodo()">ğŸ” Filtrar</button>

    <div id="resultado-historial-periodo" style="margin-top:15px;"></div>

    <div style="display:flex;justify-content:flex-end;margin-top:12px">
      <button onclick="cerrarModalHistorialPeriodo()">Cerrar</button>
    </div>
  </div>
</div>


<div id="print-contenido" class="print-area"></div>

<script type="module" src="clientes.js"></script>

</body>
</html>
