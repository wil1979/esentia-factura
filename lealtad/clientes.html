<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Esentia â€” Clientes</title>

  <link rel="stylesheet" href="clientes2.css" />

  <style>
    body { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background:#f5f6f8; }
    .layout {
      display:grid;
      grid-template-columns: 280px 1fr;
      height:100vh;
    }
    .sidebar {
      background:#7a815a;
      color:#fff;
      padding:14px;
      overflow-y:auto;
      border-radius:12px;
    }
    .sidebar h2 { margin-top:0; }
    .sidebar input {
      width:100%; padding:8px; border-radius:6px; border:none; margin-bottom:10px;
    }
    .cliente-item {
      background:#1e1e1e; padding:8px; border-radius:8px; margin-bottom:6px; cursor:pointer;
    }
    .cliente-item:hover { background:#333; }

    .main {
      padding:16px;
      overflow-y:auto;
    }

    .card {
      background:#fff;
      border-radius:12px;
      padding:14px;
      margin-bottom:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
    }

    .hidden { display:none; }

    .compra-card {
      border:1px solid #e0e0e0;
      border-radius:10px;
      padding:10px;
      margin-bottom:10px;
      background:#fafafa;
    }

    .acciones {
      display:flex;
      gap:8px;
      margin-top:8px;
      flex-wrap:wrap;
    }

    button {
      padding:6px 10px;
      border-radius:8px;
      border:none;
      cursor:pointer;
    }

    .detalle-productos {
      margin-top:8px;
      padding:8px;
      background:#fff;
      border-radius:8px;
      border:1px dashed #ddd;
      font-size:0.9em;
    }

    .detalle-productos.hidden { display:none; }

    .vacio { color:#777; font-style:italic; }
  /* ===== Layout general ===== */
#app {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ===== Panel clientes ===== */
#lista-clientes {
  width: 320px;
  min-width: 280px;
  max-width: 360px;
  overflow-y: auto;
  border-right: 1px solid #ddd;
  background: #fff;
}

/* ===== Panel detalle ===== */
#panel-detalle {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
}

/* ====== ğŸ“± MOBILE ====== */
@media (max-width: 768px) {
  #app {
    flex-direction: column;
  }

  #panel-clientes {
    width: 100%;
    max-width: 100%;
    height: 38vh;          /* ğŸ”‘ clave */
    border-right: none;
    border-bottom: 1px solid #ddd;
  }

  #panel-detalle {
    height: 62vh;
    overflow-y: auto;
  }
}
  
  </style>
</head>
<body>

<div class="layout">

  <!-- ================= SIDEBAR CLIENTES ================= -->
  <aside class="sidebar">
  <h2>ğŸ‘¥ Clientes</h2>
  <input id="buscador-clientes" type="text" placeholder="Buscar cliente..." />
  <button id="btn-nuevo-cliente">â• </button>
  <button id="btn-refrescar-clientes">ğŸ”„</button>
  <button id="btn-toggle-deudores">ğŸ’°</button> <!-- ğŸ”¹ NUEVO -->
  <div id="lista-clientes" style="margin-top:12px;"></div>
  </aside>

  <!-- ================= CONTENIDO PRINCIPAL ================= -->
  <main class="main">

    <!-- INFO CLIENTE -->
    <div id="info-cliente" class="card vacio">
      <div id="info-basica"></div>
    </div>

    <!-- HISTORIAL DE COMPRAS -->
    <div id="panel-historial" class="card hidden">
      <h3>ğŸ§¾ Historial de compras</h3>
      <div id="historial-compras"></div>
    </div>
    
    <div id="resumen-general" style="
  background:#fff;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
  border:1px solid #ddd;
">
</div>

  </main>

</div>

<!-- ================= MODAL NUEVO CLIENTE ================= -->
<div id="modal-nuevo-cliente" class="modal hidden"
  style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center;">

  <div style="background:white; padding:25px; border-radius:12px; width:90%; max-width:500px;">
    <h2>ğŸ‘¤ Registrar Nuevo Cliente</h2>

    <!-- ğŸ” Buscador desde personal.json -->
    <div style="margin-bottom:15px;">
      <label>Buscar Persona (CÃ©dula o Nombre):</label>
      <input type="text" id="buscador-personal" placeholder="Buscar en personal.json" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
      <div id="resultados-personal" 
        style="max-height:150px; overflow-y:auto; border:1px solid #eee; margin-top:5px; border-radius:6px; display:none;">
        <!-- AquÃ­ aparecen los resultados -->
      </div>
    </div>

    <!-- ğŸ†” CÃ©dula + API Hacienda -->
    <div style="margin-bottom:15px;">
      <label>CÃ©dula:</label>
      <input type="text" id="modal-cedula" placeholder="Ej: 112230405" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;" maxlength="12">
      <small id="nombre-desde-api" style="color:#4CAF50; display:block; margin-top:5px; font-weight:bold;"></small>
    </div>

    <!-- ğŸ‘¤ Nombre editable -->
    <div style="margin-bottom:15px;">
      <label>Nombre (editable):</label>
      <input type="text" id="modal-nombre" placeholder="Nombre del cliente" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;">
    </div>

    <!-- ğŸ“ TelÃ©fono -->
    <div style="margin-bottom:20px;">
      <label>TelÃ©fono (8 dÃ­gitos):</label>
      <input type="text" id="modal-telefono" placeholder="Ej: 88889999" 
        style="width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;" maxlength="8">
    </div>

    <!-- âœ… Botones -->
    <div style="display:flex; gap:10px; justify-content:flex-end;">
      <button class="boton-accion" style="background:#666; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer;"
        onclick="cerrarModalNuevoCliente()">âŒ Cancelar</button>
      <button class="boton-accion" style="background:#4CAF50; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer;"
        onclick="guardarNuevoCliente()">âœ… Guardar y Agregar Productos</button>
    </div>
  </div>
</div>

<!-- =============================== -->
<!-- ğŸ›’ MODAL PRODUCTOS / NUEVA VENTA -->
<!-- =============================== -->
<div id="modal-productos" class="modal hidden">
  <div class="modal-contenido" style="max-width:600px;">

    <h2>ğŸ›’ Nueva Venta</h2>

    <!-- PRODUCTO -->
    <label>Producto</label>
    <select id="select-producto"></select>

    <label>PresentaciÃ³n</label>
    <select id="select-variante"></select>

    <button type="button" onclick="agregarAlCarritoModal()">â• Agregar</button>

    <hr>

    <!-- CARRITO -->
    <div id="carrito-modal"></div>

    <hr>

    <!-- DESCUENTO -->
    <label>Descuento â‚¡</label>
    <input type="number" id="descuento" value="0" min="0">

    <!-- TIPO DE PAGO -->
    <label>Tipo de pago</label>
    <select id="tipo-pago">
      <option value="contado">Contado</option>
      <option value="credito">CrÃ©dito</option>
    </select>

    <!-- MÃ‰TODO DE PAGO -->
    <label>MÃ©todo de pago</label>
    <select id="metodo-pago">
      <option value="Efectivo">Efectivo</option>
      <option value="SINPE">SINPE</option>
      <option value="Transferencia">Transferencia</option>
      <option value="Tarjeta">Tarjeta</option>
    </select>

    <!-- ğŸ§¾ RESUMEN DE VENTA (ğŸ”¥ ESTE ERA EL FALTANTE ğŸ”¥) -->
    <div id="resumen-venta" style="
      margin-top: 15px;
      padding: 12px;
      border-radius: 10px;
      background: #608bb6;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    ">
      <!-- Se llena por JS -->
    </div>

    <!-- ACCIONES -->
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:15px">
      <button type="button" onclick="cerrarModalProductos()">Cancelar</button>
      <button type="button" onclick="facturarVenta()" style="background:green;color:white">
        ğŸ’¾ Facturar
      </button>
    </div>

  </div>
</div>

<!-- =============================== -->
<!-- âœï¸ MODAL EDITAR COMPRA -->
<!-- =============================== -->
<div id="modal-editar-compra" class="modal hidden">
  <div class="modal-contenido" style="max-width:600px">

    <h2>âœï¸ Editar Compra</h2>

    <div id="edit-productos"></div>

    <label>Descuento â‚¡</label>
    <input type="number" id="edit-descuento" value="0" min="0">

    <!-- RESUMEN EDICIÃ“N -->
    <div id="edit-resumen-venta"
         style="margin-top:15px;padding:12px;border-radius:10px;
                background:#f1f1f1;border:1px solid #ccc;font-size:.9rem">
    </div>

    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:15px">
      <button type="button" onclick="cerrarModalEditarCompra()">Cancelar</button>
      <button type="button" onclick="guardarEdicionCompra()"
              style="background:#1976d2;color:white">
        ğŸ’¾ Guardar
      </button>
    </div>

  </div>
</div>

<!-- ================= MODAL PAGAR FACTURA ================= -->
<div id="modal-pagar-factura" class="modal hidden">
  <div class="modal-contenido" style="max-width:420px;">
    <h2>ğŸ’³ Pagar factura</h2>

    <div id="info-factura-pago" style="margin-bottom:10px;"></div>

    <label>Monto a abonar â‚¡</label>
    <input type="number" id="abono-monto" min="1" />

    <label>MÃ©todo de pago</label>
    <select id="abono-metodo">
      <option value="Efectivo">Efectivo</option>
      <option value="SINPE">SINPE</option>
      <option value="Transferencia">Transferencia</option>
      <option value="Tarjeta">Tarjeta</option>
      <option value="Pendiente">Pendiente</option>
    </select>

    <label>Nota (opcional)</label>
    <input type="text" id="abono-nota" placeholder="Ej: SINPE 8844-XXXX" />

    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px">
      <button onclick="cerrarModalPagoFactura()">Cancelar</button>
      <button onclick="guardarPagoFactura()" style="background:green;color:white">
        ğŸ’¾ Registrar pago
      </button>
    </div>
  </div>
</div>




<script type="module" src="clientes.js"></script>

</body>
</html>
