<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cat√°logo Esentia</title>
  <link rel="icon" href="images/logo.png" sizes="192x192" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="catalogo.css" />

  <style>
    /* ... tus estilos de botones ... */
    .btn-filtro {
      background: #f0f0f0;
      border: 2px solid #ccc;
      padding: 8px 16px;
      margin: 0 5px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    .btn-filtro:hover { background: #e0e0e0; }
    .btn-filtro.activo {
      background: #6c4ba3;
      color: white;
      border-color: #6c4ba3;
    }

    /* üîß CORRECCI√ìN IM√ÅGENES */
    .producto-card img {
      width: 100%;
      height: 200px;
      object-fit: contain;
      background-color: white;
      border-radius: 8px;
      margin: 18px auto 10px auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      display: block;
    }
    #modalProductoImagen {
      width: 100%;
      max-height: 250px;
      object-fit: contain;
      background-color: white;
      border-radius: 8px;
      margin: 10px 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    /* ========== MINI CARRITO LATERAL ========== */
    #miniCarrito {
      position: fixed;
      top: 0;
      right: -380px; /* Fuera de la vista */
      width: 360px;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 20px rgba(0,0,0,0.15);
      z-index: 9998;
      transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      overflow-y: auto;
    }
    #miniCarrito.visible {
      right: 0;
    }
    #miniCarritoOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 9997;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s;
    }
    #miniCarritoOverlay.visible {
      opacity: 1;
      visibility: visible;
    }
    .mini-header {
      padding: 20px;
      background: #6c4ba3;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .mini-header h3 { margin: 0; font-size: 1.3rem; }
    .mini-close {
      background: white;
      color: #6c4ba3;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mini-producto {
      display: flex;
      padding: 16px;
      border-bottom: 1px solid #eee;
      align-items: flex-start;
    }
    .mini-producto img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      border-radius: 6px;
      margin-right: 12px;
      background: #f9f9f9;
    }
    .mini-info {
      flex: 1;
    }
    .mini-info h4 { margin: 0 0 6px 0; font-size: 1.05rem; color: #333; }
    .mini-info .precio { font-weight: bold; color: #6c4ba3; margin: 4px 0; }
    .mini-cantidad {
      display: flex;
      align-items: center;
      margin-top: 8px;
    }
    .mini-cantidad button {
      width: 28px;
      height: 28px;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 18px;
      cursor: pointer;
    }
    .mini-cantidad span {
      margin: 0 10px;
      font-weight: bold;
    }
    .mini-total {
      padding: 20px;
      font-size: 1.2rem;
      font-weight: bold;
      border-top: 2px solid #eee;
      text-align: center;
    }
    .mini-footer {
      padding: 0 20px 20px;
      text-align: center;
    }
    .mini-footer button {
      width: 100%;
      padding: 12px;
      background: #25D366;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1.05rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .mini-footer button:hover {
      background: #128C7E;
    }
  </style>
</head>
<body>
  <!-- ... tu HTML existente hasta </main> ... -->

  <main class="contenedor">
    <!-- Loader -->
    <div id="loader" style="display:flex; justify-content:center; align-items:center; height:300px; color:#6c4ba3; font-size:1.5rem; font-weight:bold;">
      <div style="text-align:center;">
        <div style="font-size:3rem; margin-bottom:10px;">‚è≥</div>
        <div>Cargando cat√°logo...</div>
      </div>
    </div>

    <!-- Filtros -->
    <div style="text-align:center; margin:1.5rem 0; display:none;" id="filtros-container">
      <button id="btnMostrarDisponibles" class="btn-filtro activo">üì¶ Disponibles</button>
      <button id="btnMostrarTodos" class="btn-filtro">üìö Ver todo el cat√°logo</button>
    </div>

    <!-- Productos -->
    <div id="productos-hogar"></div>

    <!-- Nuevas funciones -->
    <div style="text-align:center; margin:2rem 0; padding:1.2rem; background:#f9f6ff; border-radius:12px; max-width:600px; margin-left:auto; margin-right:auto;">
      <h3 style="margin-top:0; color:#6c4ba3;">¬øNo encuentras lo que buscas?</h3>
      <button onclick="solicitarAroma()" style="display:block; width:100%; padding:10px; margin:8px 0; background:#6c4ba3; color:white; border:none; border-radius:8px; cursor:pointer;">üå∏ Solicitar un aroma especial</button>
      <button onclick="recomendarPorWhatsApp()" style="display:block; width:100%; padding:10px; margin:8px 0; background:#25D366; color:white; border:none; border-radius:8px; cursor:pointer;">üì≤ Recomendar a un amigo por WhatsApp</button>
      <button onclick="copiarEnlaceRecomendacion()" style="display:block; width:100%; padding:10px; margin:8px 0; background:#4caf50; color:white; border:none; border-radius:8px; cursor:pointer;">üîó Copiar enlace para recomendar</button>
    </div>
  </main>

  <!-- ... tus modales existentes (modalProducto, modalCarrito) ... -->
  <!-- Modal Producto -->
  <div id="modalProducto" class="modal-carrito">
    <!-- ... contenido existente ... -->
  </div>

  <!-- Modal Carrito (grande) -->
  <div id="modalCarrito" class="modal-carrito">
    <!-- ... contenido existente ... -->
  </div>

  <!-- BOT√ìN FLOTANTE CARRITO (opcional: puedes mantenerlo o quitarlo) -->
  <button id="botonCarrito" onclick="abrirMiniCarrito()" style="position:fixed; top:20px; right:20px; background:#6c4ba3; color:white; border:none; border-radius:50%; width:52px; height:52px; font-size:1.7rem; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.15); z-index:999;">
    üõí <span id="contadorCarrito">0</span>
  </button>

  <!-- TOAST -->
  <div id="toast" style="position:fixed; bottom:20px; right:20px; background:#4caf50; color:white; padding:12px 16px; border-radius:6px; display:none; z-index:10000;"></div>

  <!-- MINI CARRITO LATERAL -->
  <div id="miniCarritoOverlay"></div>
  <div id="miniCarrito">
    <div class="mini-header">
      <h3>üõí Carrito</h3>
      <button class="mini-close" onclick="cerrarMiniCarrito()">√ó</button>
    </div>
    <div id="miniCarritoContenido"></div>
    <div class="mini-total" id="miniTotal">Total: ‚Ç°0</div>
    <div class="mini-footer">
      <button onclick="abrirModalCarritoCompleto()">Ver carrito completo</button>
    </div>
  </div>

  <!-- ... Firebase y Scripts ... -->
  <!-- üî• Firebase -->
  <script type="module">
    // ... tu c√≥digo de Firebase igual que antes ...
  </script>

  <script>
    // ... todo tu c√≥digo JS principal ...

    // === NUEVO: FUNCIONES DEL MINI CARRITO ===
    function abrirMiniCarrito() {
      document.getElementById('miniCarrito').classList.add('visible');
      document.getElementById('miniCarritoOverlay').classList.add('visible');
      renderMiniCarrito();
    }

    function cerrarMiniCarrito() {
      document.getElementById('miniCarrito').classList.remove('visible');
      document.getElementById('miniCarritoOverlay').classList.remove('visible');
    }

    function renderMiniCarrito() {
      const contenedor = document.getElementById('miniCarritoContenido');
      const totalEl = document.getElementById('miniTotal');
      if (carrito.length === 0) {
        contenedor.innerHTML = '<p style="text-align:center; padding:20px; color:#666;">Tu carrito est√° vac√≠o</p>';
        totalEl.textContent = 'Total: ‚Ç°0';
        return;
      }

      let total = 0;
      let html = '';
      carrito.forEach((item, index) => {
        const subtotal = item.precio * item.cantidad;
        total += subtotal;
        // Intentar obtener imagen del producto (si no, usa logo o placeholder)
        const producto = productos.find(p => p.nombre === item.nombre.split(' ')[0]) || 
                        productos.find(p => p.nombre === item.nombre);
        const imagen = producto ? producto.imagen : 'images/logo.png';

        html += `
          <div class="mini-producto">
            <img src="${imagen}" alt="${item.nombre}">
            <div class="mini-info">
              <h4>${item.nombre}</h4>
              <div class="precio">‚Ç°${item.precio.toLocaleString()}</div>
              <div class="mini-cantidad">
                <button onclick="cambiarCantidadMini(${index}, -1)">‚àí</button>
                <span>${item.cantidad}</span>
                <button onclick="cambiarCantidadMini(${index}, 1)">+</button>
              </div>
            </div>
          </div>
        `;
      });
      contenedor.innerHTML = html;
      totalEl.textContent = `Total: ‚Ç°${Math.round(total).toLocaleString()}`;
    }

    function cambiarCantidadMini(index, cambio) {
      if (cambio === -1 && carrito[index].cantidad <= 1) {
        carrito.splice(index, 1);
      } else {
        carrito[index].cantidad += cambio;
      }
      renderCarrito(); // Actualiza carrito principal y localStorage
      renderMiniCarrito(); // Actualiza mini carrito
    }

    function abrirModalCarritoCompleto() {
      cerrarMiniCarrito();
      abrirModalCarrito(); // Usa tu funci√≥n existente
    }

    // Cerrar mini carrito al hacer clic fuera
    document.getElementById('miniCarritoOverlay').addEventListener('click', cerrarMiniCarrito);

    // === MODIFICAR agregarCarrito para que muestre el mini carrito ===
    function agregarCarrito(nombre, precio) {
      const existente = carrito.find(item => item.nombre === nombre);
      if (existente) {
        existente.cantidad += 1;
      } else {
        carrito.push({ nombre, precio, cantidad: 1 });
      }
      renderCarrito();
      mostrarToast(`‚úÖ "${nombre}" agregado`);

      // ‚ú® MOSTRAR MINI CARRITO AUTOM√ÅTICAMENTE
      setTimeout(() => {
        abrirMiniCarrito();
      }, 300);
    }

    // ... resto de tus funciones (renderCarrito, finalizarPedido, etc.) ...
  </script>
</body>
</html>
